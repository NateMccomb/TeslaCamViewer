/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/webm-muxer@5.0.1/build/webm-muxer.mjs
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var _helper,_helperView,_writeByte,writeByte_fn,_writeFloat32,writeFloat32_fn,_writeFloat64,writeFloat64_fn,_writeUnsignedInt,writeUnsignedInt_fn,_writeString,writeString_fn,_target,_buffer,_bytes,_ensureSize,ensureSize_fn,__defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__pow=Math.pow,__defNormalProp=(e,t,i)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,__spreadValues=(e,t)=>{for(var i in t||={})__hasOwnProp.call(t,i)&&__defNormalProp(e,i,t[i]);if(__getOwnPropSymbols)for(var i of __getOwnPropSymbols(t))__propIsEnum.call(t,i)&&__defNormalProp(e,i,t[i]);return e},__accessCheck=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},__privateGet=(e,t,i)=>(__accessCheck(e,t,"read from private field"),i?i.call(e):t.get(e)),__privateAdd=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},__privateSet=(e,t,i,r)=>(__accessCheck(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),__privateMethod=(e,t,i)=>(__accessCheck(e,t,"access private method"),i),EBMLFloat32=class{constructor(e){this.value=e}},EBMLFloat64=class{constructor(e){this.value=e}},measureUnsignedInt=e=>e<256?1:e<65536?2:e<1<<24?3:e<__pow(2,32)?4:e<__pow(2,40)?5:6,measureEBMLVarInt=e=>{if(e<127)return 1;if(e<16383)return 2;if(e<2097151)return 3;if(e<268435455)return 4;if(e<__pow(2,35)-1)return 5;if(e<__pow(2,42)-1)return 6;throw new Error("EBML VINT size not supported "+e)},readBits=(e,t,i)=>{let r=0;for(let a=t;a<i;a++){let t=7-(7&a);r<<=1,r|=(e[Math.floor(a/8)]&1<<t)>>t}return r},writeBits=(e,t,i,r)=>{for(let a=t;a<i;a++){let t=Math.floor(a/8),_=e[t],s=7-(7&a);_&=~(1<<s),_|=(r&1<<i-a-1)>>i-a-1<<s,e[t]=_}},ArrayBufferTarget=class{constructor(){this.buffer=null}},StreamTarget=class{constructor(e){if(this.options=e,"object"!=typeof e)throw new TypeError("StreamTarget requires an options object to be passed to its constructor.");if(e.onData){if("function"!=typeof e.onData)throw new TypeError("options.onData, when provided, must be a function.");if(e.onData.length<2)throw new TypeError("options.onData, when provided, must be a function that takes in at least two arguments (data and position). Ignoring the position argument, which specifies the byte offset at which the data is to be written, can lead to broken outputs.")}if(e.onHeader&&"function"!=typeof e.onHeader)throw new TypeError("options.onHeader, when provided, must be a function.");if(e.onCluster&&"function"!=typeof e.onCluster)throw new TypeError("options.onCluster, when provided, must be a function.");if(void 0!==e.chunked&&"boolean"!=typeof e.chunked)throw new TypeError("options.chunked, when provided, must be a boolean.");if(void 0!==e.chunkSize&&(!Number.isInteger(e.chunkSize)||e.chunkSize<=0))throw new TypeError("options.chunkSize, when provided, must be a positive integer.")}},FileSystemWritableFileStreamTarget=class{constructor(e,t){if(this.stream=e,this.options=t,!(e instanceof FileSystemWritableFileStream))throw new TypeError("FileSystemWritableFileStreamTarget requires a FileSystemWritableFileStream instance.");if(void 0!==t&&"object"!=typeof t)throw new TypeError("FileSystemWritableFileStreamTarget's options, when provided, must be an object.");if(t&&void 0!==t.chunkSize&&(!Number.isInteger(t.chunkSize)||t.chunkSize<=0))throw new TypeError("options.chunkSize, when provided, must be a positive integer")}},Writer=class{constructor(){__privateAdd(this,_writeByte),__privateAdd(this,_writeFloat32),__privateAdd(this,_writeFloat64),__privateAdd(this,_writeUnsignedInt),__privateAdd(this,_writeString),this.pos=0,__privateAdd(this,_helper,new Uint8Array(8)),__privateAdd(this,_helperView,new DataView(__privateGet(this,_helper).buffer)),this.offsets=new WeakMap,this.dataOffsets=new WeakMap}seek(e){this.pos=e}writeEBMLVarInt(e,t=measureEBMLVarInt(e)){let i=0;switch(t){case 1:__privateGet(this,_helperView).setUint8(i++,128|e);break;case 2:__privateGet(this,_helperView).setUint8(i++,64|e>>8),__privateGet(this,_helperView).setUint8(i++,e);break;case 3:__privateGet(this,_helperView).setUint8(i++,32|e>>16),__privateGet(this,_helperView).setUint8(i++,e>>8),__privateGet(this,_helperView).setUint8(i++,e);break;case 4:__privateGet(this,_helperView).setUint8(i++,16|e>>24),__privateGet(this,_helperView).setUint8(i++,e>>16),__privateGet(this,_helperView).setUint8(i++,e>>8),__privateGet(this,_helperView).setUint8(i++,e);break;case 5:__privateGet(this,_helperView).setUint8(i++,8|e/__pow(2,32)&7),__privateGet(this,_helperView).setUint8(i++,e>>24),__privateGet(this,_helperView).setUint8(i++,e>>16),__privateGet(this,_helperView).setUint8(i++,e>>8),__privateGet(this,_helperView).setUint8(i++,e);break;case 6:__privateGet(this,_helperView).setUint8(i++,4|e/__pow(2,40)&3),__privateGet(this,_helperView).setUint8(i++,e/__pow(2,32)|0),__privateGet(this,_helperView).setUint8(i++,e>>24),__privateGet(this,_helperView).setUint8(i++,e>>16),__privateGet(this,_helperView).setUint8(i++,e>>8),__privateGet(this,_helperView).setUint8(i++,e);break;default:throw new Error("Bad EBML VINT size "+t)}this.write(__privateGet(this,_helper).subarray(0,i))}writeEBML(e){var t,i;if(null!==e)if(e instanceof Uint8Array)this.write(e);else if(Array.isArray(e))for(let t of e)this.writeEBML(t);else if(this.offsets.set(e,this.pos),__privateMethod(this,_writeUnsignedInt,writeUnsignedInt_fn).call(this,e.id),Array.isArray(e.data)){let i=this.pos,r=-1===e.size?1:null!=(t=e.size)?t:4;-1===e.size?__privateMethod(this,_writeByte,writeByte_fn).call(this,255):this.seek(this.pos+r);let a=this.pos;if(this.dataOffsets.set(e,a),this.writeEBML(e.data),-1!==e.size){let e=this.pos-a,t=this.pos;this.seek(i),this.writeEBMLVarInt(e,r),this.seek(t)}}else if("number"==typeof e.data){let t=null!=(i=e.size)?i:measureUnsignedInt(e.data);this.writeEBMLVarInt(t),__privateMethod(this,_writeUnsignedInt,writeUnsignedInt_fn).call(this,e.data,t)}else"string"==typeof e.data?(this.writeEBMLVarInt(e.data.length),__privateMethod(this,_writeString,writeString_fn).call(this,e.data)):e.data instanceof Uint8Array?(this.writeEBMLVarInt(e.data.byteLength,e.size),this.write(e.data)):e.data instanceof EBMLFloat32?(this.writeEBMLVarInt(4),__privateMethod(this,_writeFloat32,writeFloat32_fn).call(this,e.data.value)):e.data instanceof EBMLFloat64&&(this.writeEBMLVarInt(8),__privateMethod(this,_writeFloat64,writeFloat64_fn).call(this,e.data.value))}};_helper=new WeakMap,_helperView=new WeakMap,_writeByte=new WeakSet,writeByte_fn=function(e){__privateGet(this,_helperView).setUint8(0,e),this.write(__privateGet(this,_helper).subarray(0,1))},_writeFloat32=new WeakSet,writeFloat32_fn=function(e){__privateGet(this,_helperView).setFloat32(0,e,!1),this.write(__privateGet(this,_helper).subarray(0,4))},_writeFloat64=new WeakSet,writeFloat64_fn=function(e){__privateGet(this,_helperView).setFloat64(0,e,!1),this.write(__privateGet(this,_helper))},_writeUnsignedInt=new WeakSet,writeUnsignedInt_fn=function(e,t=measureUnsignedInt(e)){let i=0;switch(t){case 6:__privateGet(this,_helperView).setUint8(i++,e/__pow(2,40)|0);case 5:__privateGet(this,_helperView).setUint8(i++,e/__pow(2,32)|0);case 4:__privateGet(this,_helperView).setUint8(i++,e>>24);case 3:__privateGet(this,_helperView).setUint8(i++,e>>16);case 2:__privateGet(this,_helperView).setUint8(i++,e>>8);case 1:__privateGet(this,_helperView).setUint8(i++,e);break;default:throw new Error("Bad UINT size "+t)}this.write(__privateGet(this,_helper).subarray(0,i))},_writeString=new WeakSet,writeString_fn=function(e){this.write(new Uint8Array(e.split("").map((e=>e.charCodeAt(0)))))};var _trackingWrites,_trackedWrites,_trackedStart,_trackedEnd,ArrayBufferTargetWriter=class extends Writer{constructor(e){super(),__privateAdd(this,_ensureSize),__privateAdd(this,_target,void 0),__privateAdd(this,_buffer,new ArrayBuffer(__pow(2,16))),__privateAdd(this,_bytes,new Uint8Array(__privateGet(this,_buffer))),__privateSet(this,_target,e)}write(e){__privateMethod(this,_ensureSize,ensureSize_fn).call(this,this.pos+e.byteLength),__privateGet(this,_bytes).set(e,this.pos),this.pos+=e.byteLength}finalize(){__privateMethod(this,_ensureSize,ensureSize_fn).call(this,this.pos),__privateGet(this,_target).buffer=__privateGet(this,_buffer).slice(0,this.pos)}};_target=new WeakMap,_buffer=new WeakMap,_bytes=new WeakMap,_ensureSize=new WeakSet,ensureSize_fn=function(e){let t=__privateGet(this,_buffer).byteLength;for(;t<e;)t*=2;if(t===__privateGet(this,_buffer).byteLength)return;let i=new ArrayBuffer(t),r=new Uint8Array(i);r.set(__privateGet(this,_bytes),0),__privateSet(this,_buffer,i),__privateSet(this,_bytes,r)};var _sections,_lastFlushEnd,_ensureMonotonicity,BaseStreamTargetWriter=class extends Writer{constructor(e){super(),this.target=e,__privateAdd(this,_trackingWrites,!1),__privateAdd(this,_trackedWrites,void 0),__privateAdd(this,_trackedStart,void 0),__privateAdd(this,_trackedEnd,void 0)}write(e){if(!__privateGet(this,_trackingWrites))return;let t=this.pos;if(t<__privateGet(this,_trackedStart)){if(t+e.byteLength<=__privateGet(this,_trackedStart))return;e=e.subarray(__privateGet(this,_trackedStart)-t),t=0}let i=t+e.byteLength-__privateGet(this,_trackedStart),r=__privateGet(this,_trackedWrites).byteLength;for(;r<i;)r*=2;if(r!==__privateGet(this,_trackedWrites).byteLength){let e=new Uint8Array(r);e.set(__privateGet(this,_trackedWrites),0),__privateSet(this,_trackedWrites,e)}__privateGet(this,_trackedWrites).set(e,t-__privateGet(this,_trackedStart)),__privateSet(this,_trackedEnd,Math.max(__privateGet(this,_trackedEnd),t+e.byteLength))}startTrackingWrites(){__privateSet(this,_trackingWrites,!0),__privateSet(this,_trackedWrites,new Uint8Array(__pow(2,10))),__privateSet(this,_trackedStart,this.pos),__privateSet(this,_trackedEnd,this.pos)}getTrackedWrites(){if(!__privateGet(this,_trackingWrites))throw new Error("Can't get tracked writes since nothing was tracked.");let e={data:__privateGet(this,_trackedWrites).subarray(0,__privateGet(this,_trackedEnd)-__privateGet(this,_trackedStart)),start:__privateGet(this,_trackedStart),end:__privateGet(this,_trackedEnd)};return __privateSet(this,_trackedWrites,void 0),__privateSet(this,_trackingWrites,!1),e}};_trackingWrites=new WeakMap,_trackedWrites=new WeakMap,_trackedStart=new WeakMap,_trackedEnd=new WeakMap;var StreamTargetWriter=class extends BaseStreamTargetWriter{constructor(e,t){super(e),__privateAdd(this,_sections,[]),__privateAdd(this,_lastFlushEnd,0),__privateAdd(this,_ensureMonotonicity,void 0),__privateSet(this,_ensureMonotonicity,t)}write(e){super.write(e),__privateGet(this,_sections).push({data:e.slice(),start:this.pos}),this.pos+=e.byteLength}flush(){var e,t;if(0===__privateGet(this,_sections).length)return;let i=[],r=[...__privateGet(this,_sections)].sort(((e,t)=>e.start-t.start));i.push({start:r[0].start,size:r[0].data.byteLength});for(let e=1;e<r.length;e++){let t=i[i.length-1],a=r[e];a.start<=t.start+t.size?t.size=Math.max(t.size,a.start+a.data.byteLength-t.start):i.push({start:a.start,size:a.data.byteLength})}for(let r of i){r.data=new Uint8Array(r.size);for(let e of __privateGet(this,_sections))r.start<=e.start&&e.start<r.start+r.size&&r.data.set(e.data,e.start-r.start);if(__privateGet(this,_ensureMonotonicity)&&r.start<__privateGet(this,_lastFlushEnd))throw new Error("Internal error: Monotonicity violation.");null==(t=(e=this.target.options).onData)||t.call(e,r.data,r.start),__privateSet(this,_lastFlushEnd,r.start+r.data.byteLength)}__privateGet(this,_sections).length=0}finalize(){}};_sections=new WeakMap,_lastFlushEnd=new WeakMap,_ensureMonotonicity=new WeakMap;var _chunkSize,_chunks,_lastFlushEnd2,_ensureMonotonicity2,_writeDataIntoChunks,writeDataIntoChunks_fn,_insertSectionIntoChunk,insertSectionIntoChunk_fn,_createChunk,createChunk_fn,_flushChunks,flushChunks_fn,DEFAULT_CHUNK_SIZE=__pow(2,24),MAX_CHUNKS_AT_ONCE=2,ChunkedStreamTargetWriter=class extends BaseStreamTargetWriter{constructor(e,t){var i,r;if(super(e),__privateAdd(this,_writeDataIntoChunks),__privateAdd(this,_insertSectionIntoChunk),__privateAdd(this,_createChunk),__privateAdd(this,_flushChunks),__privateAdd(this,_chunkSize,void 0),__privateAdd(this,_chunks,[]),__privateAdd(this,_lastFlushEnd2,0),__privateAdd(this,_ensureMonotonicity2,void 0),__privateSet(this,_chunkSize,null!=(r=null==(i=e.options)?void 0:i.chunkSize)?r:DEFAULT_CHUNK_SIZE),__privateSet(this,_ensureMonotonicity2,t),!Number.isInteger(__privateGet(this,_chunkSize))||__privateGet(this,_chunkSize)<__pow(2,10))throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(e){super.write(e),__privateMethod(this,_writeDataIntoChunks,writeDataIntoChunks_fn).call(this,e,this.pos),__privateMethod(this,_flushChunks,flushChunks_fn).call(this),this.pos+=e.byteLength}finalize(){__privateMethod(this,_flushChunks,flushChunks_fn).call(this,!0)}};_chunkSize=new WeakMap,_chunks=new WeakMap,_lastFlushEnd2=new WeakMap,_ensureMonotonicity2=new WeakMap,_writeDataIntoChunks=new WeakSet,writeDataIntoChunks_fn=function(e,t){let i=__privateGet(this,_chunks).findIndex((e=>e.start<=t&&t<e.start+__privateGet(this,_chunkSize)));-1===i&&(i=__privateMethod(this,_createChunk,createChunk_fn).call(this,t));let r=__privateGet(this,_chunks)[i],a=t-r.start,_=e.subarray(0,Math.min(__privateGet(this,_chunkSize)-a,e.byteLength));r.data.set(_,a);let s={start:a,end:a+_.byteLength};if(__privateMethod(this,_insertSectionIntoChunk,insertSectionIntoChunk_fn).call(this,r,s),0===r.written[0].start&&r.written[0].end===__privateGet(this,_chunkSize)&&(r.shouldFlush=!0),__privateGet(this,_chunks).length>MAX_CHUNKS_AT_ONCE){for(let e=0;e<__privateGet(this,_chunks).length-1;e++)__privateGet(this,_chunks)[e].shouldFlush=!0;__privateMethod(this,_flushChunks,flushChunks_fn).call(this)}_.byteLength<e.byteLength&&__privateMethod(this,_writeDataIntoChunks,writeDataIntoChunks_fn).call(this,e.subarray(_.byteLength),t+_.byteLength)},_insertSectionIntoChunk=new WeakSet,insertSectionIntoChunk_fn=function(e,t){let i=0,r=e.written.length-1,a=-1;for(;i<=r;){let _=Math.floor(i+(r-i+1)/2);e.written[_].start<=t.start?(i=_+1,a=_):r=_-1}for(e.written.splice(a+1,0,t),(-1===a||e.written[a].end<t.start)&&a++;a<e.written.length-1&&e.written[a].end>=e.written[a+1].start;)e.written[a].end=Math.max(e.written[a].end,e.written[a+1].end),e.written.splice(a+1,1)},_createChunk=new WeakSet,createChunk_fn=function(e){let t={start:Math.floor(e/__privateGet(this,_chunkSize))*__privateGet(this,_chunkSize),data:new Uint8Array(__privateGet(this,_chunkSize)),written:[],shouldFlush:!1};return __privateGet(this,_chunks).push(t),__privateGet(this,_chunks).sort(((e,t)=>e.start-t.start)),__privateGet(this,_chunks).indexOf(t)},_flushChunks=new WeakSet,flushChunks_fn=function(e=!1){var t,i;for(let r=0;r<__privateGet(this,_chunks).length;r++){let a=__privateGet(this,_chunks)[r];if(a.shouldFlush||e){for(let e of a.written){if(__privateGet(this,_ensureMonotonicity2)&&a.start+e.start<__privateGet(this,_lastFlushEnd2))throw new Error("Internal error: Monotonicity violation.");null==(i=(t=this.target.options).onData)||i.call(t,a.data.subarray(e.start,e.end),a.start+e.start),__privateSet(this,_lastFlushEnd2,a.start+e.end)}__privateGet(this,_chunks).splice(r--,1)}}};var _options,_writer,_segment,_segmentInfo,_seekHead,_tracksElement,_segmentDuration,_colourElement,_videoCodecPrivate,_audioCodecPrivate,_subtitleCodecPrivate,_cues,_currentCluster,_currentClusterTimestamp,_duration,_videoChunkQueue,_audioChunkQueue,_subtitleChunkQueue,_firstVideoTimestamp,_firstAudioTimestamp,_lastVideoTimestamp,_lastAudioTimestamp,_lastSubtitleTimestamp,_colorSpace,_finalized,_validateOptions,validateOptions_fn,_createFileHeader,createFileHeader_fn,_writeEBMLHeader,writeEBMLHeader_fn,_createCodecPrivatePlaceholders,createCodecPrivatePlaceholders_fn,_createColourElement,createColourElement_fn,_createSeekHead,createSeekHead_fn,_createSegmentInfo,createSegmentInfo_fn,_createTracks,createTracks_fn,_createSegment,createSegment_fn,_createCues,createCues_fn,_maybeFlushStreamingTargetWriter,maybeFlushStreamingTargetWriter_fn,_segmentDataOffset,segmentDataOffset_get,_writeVideoDecoderConfig,writeVideoDecoderConfig_fn,_fixVP9ColorSpace,fixVP9ColorSpace_fn,_writeSubtitleChunks,writeSubtitleChunks_fn,_createInternalChunk,createInternalChunk_fn,_validateTimestamp,validateTimestamp_fn,_writeBlock,writeBlock_fn,_createCodecPrivateElement,createCodecPrivateElement_fn,_writeCodecPrivate,writeCodecPrivate_fn,_createNewCluster,createNewCluster_fn,_finalizeCurrentCluster,finalizeCurrentCluster_fn,_ensureNotFinalized,ensureNotFinalized_fn,FileSystemWritableFileStreamTargetWriter=class extends ChunkedStreamTargetWriter{constructor(e,t){var i;super(new StreamTarget({onData:(t,i)=>e.stream.write({type:"write",data:t,position:i}),chunked:!0,chunkSize:null==(i=e.options)?void 0:i.chunkSize}),t)}},VIDEO_TRACK_NUMBER=1,AUDIO_TRACK_NUMBER=2,SUBTITLE_TRACK_NUMBER=3,VIDEO_TRACK_TYPE=1,AUDIO_TRACK_TYPE=2,SUBTITLE_TRACK_TYPE=17,MAX_CHUNK_LENGTH_MS=__pow(2,15),CODEC_PRIVATE_MAX_SIZE=__pow(2,12),APP_NAME="https://github.com/Vanilagy/webm-muxer",SEGMENT_SIZE_BYTES=6,CLUSTER_SIZE_BYTES=5,FIRST_TIMESTAMP_BEHAVIORS=["strict","offset","permissive"],Muxer=class{constructor(e){var t;__privateAdd(this,_validateOptions),__privateAdd(this,_createFileHeader),__privateAdd(this,_writeEBMLHeader),__privateAdd(this,_createCodecPrivatePlaceholders),__privateAdd(this,_createColourElement),__privateAdd(this,_createSeekHead),__privateAdd(this,_createSegmentInfo),__privateAdd(this,_createTracks),__privateAdd(this,_createSegment),__privateAdd(this,_createCues),__privateAdd(this,_maybeFlushStreamingTargetWriter),__privateAdd(this,_segmentDataOffset),__privateAdd(this,_writeVideoDecoderConfig),__privateAdd(this,_fixVP9ColorSpace),__privateAdd(this,_writeSubtitleChunks),__privateAdd(this,_createInternalChunk),__privateAdd(this,_validateTimestamp),__privateAdd(this,_writeBlock),__privateAdd(this,_createCodecPrivateElement),__privateAdd(this,_writeCodecPrivate),__privateAdd(this,_createNewCluster),__privateAdd(this,_finalizeCurrentCluster),__privateAdd(this,_ensureNotFinalized),__privateAdd(this,_options,void 0),__privateAdd(this,_writer,void 0),__privateAdd(this,_segment,void 0),__privateAdd(this,_segmentInfo,void 0),__privateAdd(this,_seekHead,void 0),__privateAdd(this,_tracksElement,void 0),__privateAdd(this,_segmentDuration,void 0),__privateAdd(this,_colourElement,void 0),__privateAdd(this,_videoCodecPrivate,void 0),__privateAdd(this,_audioCodecPrivate,void 0),__privateAdd(this,_subtitleCodecPrivate,void 0),__privateAdd(this,_cues,void 0),__privateAdd(this,_currentCluster,void 0),__privateAdd(this,_currentClusterTimestamp,void 0),__privateAdd(this,_duration,0),__privateAdd(this,_videoChunkQueue,[]),__privateAdd(this,_audioChunkQueue,[]),__privateAdd(this,_subtitleChunkQueue,[]),__privateAdd(this,_firstVideoTimestamp,void 0),__privateAdd(this,_firstAudioTimestamp,void 0),__privateAdd(this,_lastVideoTimestamp,-1),__privateAdd(this,_lastAudioTimestamp,-1),__privateAdd(this,_lastSubtitleTimestamp,-1),__privateAdd(this,_colorSpace,void 0),__privateAdd(this,_finalized,!1),__privateMethod(this,_validateOptions,validateOptions_fn).call(this,e),__privateSet(this,_options,__spreadValues({type:"webm",firstTimestampBehavior:"strict"},e)),this.target=e.target;let i=!!__privateGet(this,_options).streaming;if(e.target instanceof ArrayBufferTarget)__privateSet(this,_writer,new ArrayBufferTargetWriter(e.target));else if(e.target instanceof StreamTarget)__privateSet(this,_writer,(null==(t=e.target.options)?void 0:t.chunked)?new ChunkedStreamTargetWriter(e.target,i):new StreamTargetWriter(e.target,i));else{if(!(e.target instanceof FileSystemWritableFileStreamTarget))throw new Error(`Invalid target: ${e.target}`);__privateSet(this,_writer,new FileSystemWritableFileStreamTargetWriter(e.target,i))}__privateMethod(this,_createFileHeader,createFileHeader_fn).call(this)}addVideoChunk(e,t,i){if(!(e instanceof EncodedVideoChunk))throw new TypeError("addVideoChunk's first argument (chunk) must be of type EncodedVideoChunk.");if(t&&"object"!=typeof t)throw new TypeError("addVideoChunk's second argument (meta), when provided, must be an object.");if(void 0!==i&&(!Number.isFinite(i)||i<0))throw new TypeError("addVideoChunk's third argument (timestamp), when provided, must be a non-negative real number.");let r=new Uint8Array(e.byteLength);e.copyTo(r),this.addVideoChunkRaw(r,e.type,null!=i?i:e.timestamp,t)}addVideoChunkRaw(e,t,i,r){if(!(e instanceof Uint8Array))throw new TypeError("addVideoChunkRaw's first argument (data) must be an instance of Uint8Array.");if("key"!==t&&"delta"!==t)throw new TypeError("addVideoChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(i)||i<0)throw new TypeError("addVideoChunkRaw's third argument (timestamp) must be a non-negative real number.");if(r&&"object"!=typeof r)throw new TypeError("addVideoChunkRaw's fourth argument (meta), when provided, must be an object.");if(__privateMethod(this,_ensureNotFinalized,ensureNotFinalized_fn).call(this),!__privateGet(this,_options).video)throw new Error("No video track declared.");void 0===__privateGet(this,_firstVideoTimestamp)&&__privateSet(this,_firstVideoTimestamp,i),r&&__privateMethod(this,_writeVideoDecoderConfig,writeVideoDecoderConfig_fn).call(this,r);let a=__privateMethod(this,_createInternalChunk,createInternalChunk_fn).call(this,e,t,i,VIDEO_TRACK_NUMBER);for("V_VP9"===__privateGet(this,_options).video.codec&&__privateMethod(this,_fixVP9ColorSpace,fixVP9ColorSpace_fn).call(this,a),__privateSet(this,_lastVideoTimestamp,a.timestamp);__privateGet(this,_audioChunkQueue).length>0&&__privateGet(this,_audioChunkQueue)[0].timestamp<=a.timestamp;){let e=__privateGet(this,_audioChunkQueue).shift();__privateMethod(this,_writeBlock,writeBlock_fn).call(this,e,!1)}!__privateGet(this,_options).audio||a.timestamp<=__privateGet(this,_lastAudioTimestamp)?__privateMethod(this,_writeBlock,writeBlock_fn).call(this,a,!0):__privateGet(this,_videoChunkQueue).push(a),__privateMethod(this,_writeSubtitleChunks,writeSubtitleChunks_fn).call(this),__privateMethod(this,_maybeFlushStreamingTargetWriter,maybeFlushStreamingTargetWriter_fn).call(this)}addAudioChunk(e,t,i){if(!(e instanceof EncodedAudioChunk))throw new TypeError("addAudioChunk's first argument (chunk) must be of type EncodedAudioChunk.");if(t&&"object"!=typeof t)throw new TypeError("addAudioChunk's second argument (meta), when provided, must be an object.");if(void 0!==i&&(!Number.isFinite(i)||i<0))throw new TypeError("addAudioChunk's third argument (timestamp), when provided, must be a non-negative real number.");let r=new Uint8Array(e.byteLength);e.copyTo(r),this.addAudioChunkRaw(r,e.type,null!=i?i:e.timestamp,t)}addAudioChunkRaw(e,t,i,r){if(!(e instanceof Uint8Array))throw new TypeError("addAudioChunkRaw's first argument (data) must be an instance of Uint8Array.");if("key"!==t&&"delta"!==t)throw new TypeError("addAudioChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(i)||i<0)throw new TypeError("addAudioChunkRaw's third argument (timestamp) must be a non-negative real number.");if(r&&"object"!=typeof r)throw new TypeError("addAudioChunkRaw's fourth argument (meta), when provided, must be an object.");if(__privateMethod(this,_ensureNotFinalized,ensureNotFinalized_fn).call(this),!__privateGet(this,_options).audio)throw new Error("No audio track declared.");void 0===__privateGet(this,_firstAudioTimestamp)&&__privateSet(this,_firstAudioTimestamp,i),(null==r?void 0:r.decoderConfig)&&(__privateGet(this,_options).streaming?__privateSet(this,_audioCodecPrivate,__privateMethod(this,_createCodecPrivateElement,createCodecPrivateElement_fn).call(this,r.decoderConfig.description)):__privateMethod(this,_writeCodecPrivate,writeCodecPrivate_fn).call(this,__privateGet(this,_audioCodecPrivate),r.decoderConfig.description));let a=__privateMethod(this,_createInternalChunk,createInternalChunk_fn).call(this,e,t,i,AUDIO_TRACK_NUMBER);for(__privateSet(this,_lastAudioTimestamp,a.timestamp);__privateGet(this,_videoChunkQueue).length>0&&__privateGet(this,_videoChunkQueue)[0].timestamp<=a.timestamp;){let e=__privateGet(this,_videoChunkQueue).shift();__privateMethod(this,_writeBlock,writeBlock_fn).call(this,e,!0)}!__privateGet(this,_options).video||a.timestamp<=__privateGet(this,_lastVideoTimestamp)?__privateMethod(this,_writeBlock,writeBlock_fn).call(this,a,!__privateGet(this,_options).video):__privateGet(this,_audioChunkQueue).push(a),__privateMethod(this,_writeSubtitleChunks,writeSubtitleChunks_fn).call(this),__privateMethod(this,_maybeFlushStreamingTargetWriter,maybeFlushStreamingTargetWriter_fn).call(this)}addSubtitleChunk(e,t,i){if("object"!=typeof e||!e)throw new TypeError("addSubtitleChunk's first argument (chunk) must be an object.");if(!(e.body instanceof Uint8Array))throw new TypeError("body must be an instance of Uint8Array.");if(!Number.isFinite(e.timestamp)||e.timestamp<0)throw new TypeError("timestamp must be a non-negative real number.");if(!Number.isFinite(e.duration)||e.duration<0)throw new TypeError("duration must be a non-negative real number.");if(e.additions&&!(e.additions instanceof Uint8Array))throw new TypeError("additions, when present, must be an instance of Uint8Array.");if("object"!=typeof t)throw new TypeError("addSubtitleChunk's second argument (meta) must be an object.");if(__privateMethod(this,_ensureNotFinalized,ensureNotFinalized_fn).call(this),!__privateGet(this,_options).subtitles)throw new Error("No subtitle track declared.");(null==t?void 0:t.decoderConfig)&&(__privateGet(this,_options).streaming?__privateSet(this,_subtitleCodecPrivate,__privateMethod(this,_createCodecPrivateElement,createCodecPrivateElement_fn).call(this,t.decoderConfig.description)):__privateMethod(this,_writeCodecPrivate,writeCodecPrivate_fn).call(this,__privateGet(this,_subtitleCodecPrivate),t.decoderConfig.description));let r=__privateMethod(this,_createInternalChunk,createInternalChunk_fn).call(this,e.body,"key",null!=i?i:e.timestamp,SUBTITLE_TRACK_NUMBER,e.duration,e.additions);__privateSet(this,_lastSubtitleTimestamp,r.timestamp),__privateGet(this,_subtitleChunkQueue).push(r),__privateMethod(this,_writeSubtitleChunks,writeSubtitleChunks_fn).call(this),__privateMethod(this,_maybeFlushStreamingTargetWriter,maybeFlushStreamingTargetWriter_fn).call(this)}finalize(){if(__privateGet(this,_finalized))throw new Error("Cannot finalize a muxer more than once.");for(;__privateGet(this,_videoChunkQueue).length>0;)__privateMethod(this,_writeBlock,writeBlock_fn).call(this,__privateGet(this,_videoChunkQueue).shift(),!0);for(;__privateGet(this,_audioChunkQueue).length>0;)__privateMethod(this,_writeBlock,writeBlock_fn).call(this,__privateGet(this,_audioChunkQueue).shift(),!0);for(;__privateGet(this,_subtitleChunkQueue).length>0&&__privateGet(this,_subtitleChunkQueue)[0].timestamp<=__privateGet(this,_duration);)__privateMethod(this,_writeBlock,writeBlock_fn).call(this,__privateGet(this,_subtitleChunkQueue).shift(),!1);if(__privateGet(this,_options).streaming||__privateMethod(this,_finalizeCurrentCluster,finalizeCurrentCluster_fn).call(this),__privateGet(this,_writer).writeEBML(__privateGet(this,_cues)),!__privateGet(this,_options).streaming){let e=__privateGet(this,_writer).pos,t=__privateGet(this,_writer).pos-__privateGet(this,_segmentDataOffset,segmentDataOffset_get);__privateGet(this,_writer).seek(__privateGet(this,_writer).offsets.get(__privateGet(this,_segment))+4),__privateGet(this,_writer).writeEBMLVarInt(t,SEGMENT_SIZE_BYTES),__privateGet(this,_segmentDuration).data=new EBMLFloat64(__privateGet(this,_duration)),__privateGet(this,_writer).seek(__privateGet(this,_writer).offsets.get(__privateGet(this,_segmentDuration))),__privateGet(this,_writer).writeEBML(__privateGet(this,_segmentDuration)),__privateGet(this,_seekHead).data[0].data[1].data=__privateGet(this,_writer).offsets.get(__privateGet(this,_cues))-__privateGet(this,_segmentDataOffset,segmentDataOffset_get),__privateGet(this,_seekHead).data[1].data[1].data=__privateGet(this,_writer).offsets.get(__privateGet(this,_segmentInfo))-__privateGet(this,_segmentDataOffset,segmentDataOffset_get),__privateGet(this,_seekHead).data[2].data[1].data=__privateGet(this,_writer).offsets.get(__privateGet(this,_tracksElement))-__privateGet(this,_segmentDataOffset,segmentDataOffset_get),__privateGet(this,_writer).seek(__privateGet(this,_writer).offsets.get(__privateGet(this,_seekHead))),__privateGet(this,_writer).writeEBML(__privateGet(this,_seekHead)),__privateGet(this,_writer).seek(e)}__privateMethod(this,_maybeFlushStreamingTargetWriter,maybeFlushStreamingTargetWriter_fn).call(this),__privateGet(this,_writer).finalize(),__privateSet(this,_finalized,!0)}};_options=new WeakMap,_writer=new WeakMap,_segment=new WeakMap,_segmentInfo=new WeakMap,_seekHead=new WeakMap,_tracksElement=new WeakMap,_segmentDuration=new WeakMap,_colourElement=new WeakMap,_videoCodecPrivate=new WeakMap,_audioCodecPrivate=new WeakMap,_subtitleCodecPrivate=new WeakMap,_cues=new WeakMap,_currentCluster=new WeakMap,_currentClusterTimestamp=new WeakMap,_duration=new WeakMap,_videoChunkQueue=new WeakMap,_audioChunkQueue=new WeakMap,_subtitleChunkQueue=new WeakMap,_firstVideoTimestamp=new WeakMap,_firstAudioTimestamp=new WeakMap,_lastVideoTimestamp=new WeakMap,_lastAudioTimestamp=new WeakMap,_lastSubtitleTimestamp=new WeakMap,_colorSpace=new WeakMap,_finalized=new WeakMap,_validateOptions=new WeakSet,validateOptions_fn=function(e){if("object"!=typeof e)throw new TypeError("The muxer requires an options object to be passed to its constructor.");if(e.video){if("string"!=typeof e.video.codec)throw new TypeError(`Invalid video codec: ${e.video.codec}. Must be a string.`);if(!Number.isInteger(e.video.width)||e.video.width<=0)throw new TypeError(`Invalid video width: ${e.video.width}. Must be a positive integer.`);if(!Number.isInteger(e.video.height)||e.video.height<=0)throw new TypeError(`Invalid video height: ${e.video.height}. Must be a positive integer.`);if(void 0!==e.video.frameRate&&(!Number.isFinite(e.video.frameRate)||e.video.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${e.video.frameRate}. Must be a positive number.`);if(void 0!==e.video.alpha&&"boolean"!=typeof e.video.alpha)throw new TypeError(`Invalid video alpha: ${e.video.alpha}. Must be a boolean.`)}if(e.audio){if("string"!=typeof e.audio.codec)throw new TypeError(`Invalid audio codec: ${e.audio.codec}. Must be a string.`);if(!Number.isInteger(e.audio.numberOfChannels)||e.audio.numberOfChannels<=0)throw new TypeError(`Invalid number of audio channels: ${e.audio.numberOfChannels}. Must be a positive integer.`);if(!Number.isInteger(e.audio.sampleRate)||e.audio.sampleRate<=0)throw new TypeError(`Invalid audio sample rate: ${e.audio.sampleRate}. Must be a positive integer.`);if(void 0!==e.audio.bitDepth&&(!Number.isInteger(e.audio.bitDepth)||e.audio.bitDepth<=0))throw new TypeError(`Invalid audio bit depth: ${e.audio.bitDepth}. Must be a positive integer.`)}if(e.subtitles&&"string"!=typeof e.subtitles.codec)throw new TypeError(`Invalid subtitles codec: ${e.subtitles.codec}. Must be a string.`);if(void 0!==e.type&&!["webm","matroska"].includes(e.type))throw new TypeError(`Invalid type: ${e.type}. Must be 'webm' or 'matroska'.`);if(e.firstTimestampBehavior&&!FIRST_TIMESTAMP_BEHAVIORS.includes(e.firstTimestampBehavior))throw new TypeError(`Invalid first timestamp behavior: ${e.firstTimestampBehavior}`);if(void 0!==e.streaming&&"boolean"!=typeof e.streaming)throw new TypeError(`Invalid streaming option: ${e.streaming}. Must be a boolean.`)},_createFileHeader=new WeakSet,createFileHeader_fn=function(){__privateGet(this,_writer)instanceof BaseStreamTargetWriter&&__privateGet(this,_writer).target.options.onHeader&&__privateGet(this,_writer).startTrackingWrites(),__privateMethod(this,_writeEBMLHeader,writeEBMLHeader_fn).call(this),__privateGet(this,_options).streaming||__privateMethod(this,_createSeekHead,createSeekHead_fn).call(this),__privateMethod(this,_createSegmentInfo,createSegmentInfo_fn).call(this),__privateMethod(this,_createCodecPrivatePlaceholders,createCodecPrivatePlaceholders_fn).call(this),__privateMethod(this,_createColourElement,createColourElement_fn).call(this),__privateGet(this,_options).streaming||(__privateMethod(this,_createTracks,createTracks_fn).call(this),__privateMethod(this,_createSegment,createSegment_fn).call(this)),__privateMethod(this,_createCues,createCues_fn).call(this),__privateMethod(this,_maybeFlushStreamingTargetWriter,maybeFlushStreamingTargetWriter_fn).call(this)},_writeEBMLHeader=new WeakSet,writeEBMLHeader_fn=function(){var e;let t={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:null!=(e=__privateGet(this,_options).type)?e:"webm"},{id:17031,data:2},{id:17029,data:2}]};__privateGet(this,_writer).writeEBML(t)},_createCodecPrivatePlaceholders=new WeakSet,createCodecPrivatePlaceholders_fn=function(){__privateSet(this,_videoCodecPrivate,{id:236,size:4,data:new Uint8Array(CODEC_PRIVATE_MAX_SIZE)}),__privateSet(this,_audioCodecPrivate,{id:236,size:4,data:new Uint8Array(CODEC_PRIVATE_MAX_SIZE)}),__privateSet(this,_subtitleCodecPrivate,{id:236,size:4,data:new Uint8Array(CODEC_PRIVATE_MAX_SIZE)})},_createColourElement=new WeakSet,createColourElement_fn=function(){__privateSet(this,_colourElement,{id:21936,data:[{id:21937,data:2},{id:21946,data:2},{id:21947,data:2},{id:21945,data:0}]})},_createSeekHead=new WeakSet,createSeekHead_fn=function(){const e=new Uint8Array([28,83,187,107]),t=new Uint8Array([21,73,169,102]),i=new Uint8Array([22,84,174,107]);__privateSet(this,_seekHead,{id:290298740,data:[{id:19899,data:[{id:21419,data:e},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:t},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:i},{id:21420,size:5,data:0}]}]})},_createSegmentInfo=new WeakSet,createSegmentInfo_fn=function(){let e={id:17545,data:new EBMLFloat64(0)};__privateSet(this,_segmentDuration,e);let t={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:APP_NAME},{id:22337,data:APP_NAME},__privateGet(this,_options).streaming?null:e]};__privateSet(this,_segmentInfo,t)},_createTracks=new WeakSet,createTracks_fn=function(){let e={id:374648427,data:[]};__privateSet(this,_tracksElement,e),__privateGet(this,_options).video&&e.data.push({id:174,data:[{id:215,data:VIDEO_TRACK_NUMBER},{id:29637,data:VIDEO_TRACK_NUMBER},{id:131,data:VIDEO_TRACK_TYPE},{id:134,data:__privateGet(this,_options).video.codec},__privateGet(this,_videoCodecPrivate),__privateGet(this,_options).video.frameRate?{id:2352003,data:1e9/__privateGet(this,_options).video.frameRate}:null,{id:224,data:[{id:176,data:__privateGet(this,_options).video.width},{id:186,data:__privateGet(this,_options).video.height},__privateGet(this,_options).video.alpha?{id:21440,data:1}:null,__privateGet(this,_colourElement)]}]}),__privateGet(this,_options).audio&&(__privateSet(this,_audioCodecPrivate,__privateGet(this,_options).streaming?__privateGet(this,_audioCodecPrivate)||null:{id:236,size:4,data:new Uint8Array(CODEC_PRIVATE_MAX_SIZE)}),e.data.push({id:174,data:[{id:215,data:AUDIO_TRACK_NUMBER},{id:29637,data:AUDIO_TRACK_NUMBER},{id:131,data:AUDIO_TRACK_TYPE},{id:134,data:__privateGet(this,_options).audio.codec},__privateGet(this,_audioCodecPrivate),{id:225,data:[{id:181,data:new EBMLFloat32(__privateGet(this,_options).audio.sampleRate)},{id:159,data:__privateGet(this,_options).audio.numberOfChannels},__privateGet(this,_options).audio.bitDepth?{id:25188,data:__privateGet(this,_options).audio.bitDepth}:null]}]})),__privateGet(this,_options).subtitles&&e.data.push({id:174,data:[{id:215,data:SUBTITLE_TRACK_NUMBER},{id:29637,data:SUBTITLE_TRACK_NUMBER},{id:131,data:SUBTITLE_TRACK_TYPE},{id:134,data:__privateGet(this,_options).subtitles.codec},__privateGet(this,_subtitleCodecPrivate)]})},_createSegment=new WeakSet,createSegment_fn=function(){let e={id:408125543,size:__privateGet(this,_options).streaming?-1:SEGMENT_SIZE_BYTES,data:[__privateGet(this,_options).streaming?null:__privateGet(this,_seekHead),__privateGet(this,_segmentInfo),__privateGet(this,_tracksElement)]};if(__privateSet(this,_segment,e),__privateGet(this,_writer).writeEBML(e),__privateGet(this,_writer)instanceof BaseStreamTargetWriter&&__privateGet(this,_writer).target.options.onHeader){let{data:e,start:t}=__privateGet(this,_writer).getTrackedWrites();__privateGet(this,_writer).target.options.onHeader(e,t)}},_createCues=new WeakSet,createCues_fn=function(){__privateSet(this,_cues,{id:475249515,data:[]})},_maybeFlushStreamingTargetWriter=new WeakSet,maybeFlushStreamingTargetWriter_fn=function(){__privateGet(this,_writer)instanceof StreamTargetWriter&&__privateGet(this,_writer).flush()},_segmentDataOffset=new WeakSet,segmentDataOffset_get=function(){return __privateGet(this,_writer).dataOffsets.get(__privateGet(this,_segment))},_writeVideoDecoderConfig=new WeakSet,writeVideoDecoderConfig_fn=function(e){if(e.decoderConfig){if(e.decoderConfig.colorSpace){let t=e.decoderConfig.colorSpace;if(__privateSet(this,_colorSpace,t),__privateGet(this,_colourElement).data=[{id:21937,data:{rgb:1,bt709:1,bt470bg:5,smpte170m:6}[t.matrix]},{id:21946,data:{bt709:1,smpte170m:6,"iec61966-2-1":13}[t.transfer]},{id:21947,data:{bt709:1,bt470bg:5,smpte170m:6}[t.primaries]},{id:21945,data:[1,2][Number(t.fullRange)]}],!__privateGet(this,_options).streaming){let e=__privateGet(this,_writer).pos;__privateGet(this,_writer).seek(__privateGet(this,_writer).offsets.get(__privateGet(this,_colourElement))),__privateGet(this,_writer).writeEBML(__privateGet(this,_colourElement)),__privateGet(this,_writer).seek(e)}}e.decoderConfig.description&&(__privateGet(this,_options).streaming?__privateSet(this,_videoCodecPrivate,__privateMethod(this,_createCodecPrivateElement,createCodecPrivateElement_fn).call(this,e.decoderConfig.description)):__privateMethod(this,_writeCodecPrivate,writeCodecPrivate_fn).call(this,__privateGet(this,_videoCodecPrivate),e.decoderConfig.description))}},_fixVP9ColorSpace=new WeakSet,fixVP9ColorSpace_fn=function(e){if("key"!==e.type)return;if(!__privateGet(this,_colorSpace))return;let t=0;if(2!==readBits(e.data,0,2))return;t+=2;let i=(readBits(e.data,t+1,t+2)<<1)+readBits(e.data,t+0,t+1);t+=2,3===i&&t++;let r=readBits(e.data,t+0,t+1);if(t++,r)return;let a=readBits(e.data,t+0,t+1);if(t++,0!==a)return;t+=2;let _=readBits(e.data,t+0,t+24);if(t+=24,4817730!==_)return;i>=2&&t++;let s={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[__privateGet(this,_colorSpace).matrix];writeBits(e.data,t+0,t+3,s)},_writeSubtitleChunks=new WeakSet,writeSubtitleChunks_fn=function(){let e=Math.min(__privateGet(this,_options).video?__privateGet(this,_lastVideoTimestamp):1/0,__privateGet(this,_options).audio?__privateGet(this,_lastAudioTimestamp):1/0),t=__privateGet(this,_subtitleChunkQueue);for(;t.length>0&&t[0].timestamp<=e;)__privateMethod(this,_writeBlock,writeBlock_fn).call(this,t.shift(),!__privateGet(this,_options).video&&!__privateGet(this,_options).audio)},_createInternalChunk=new WeakSet,createInternalChunk_fn=function(e,t,i,r,a,_){return{data:e,additions:_,type:t,timestamp:__privateMethod(this,_validateTimestamp,validateTimestamp_fn).call(this,i,r),duration:a,trackNumber:r}},_validateTimestamp=new WeakSet,validateTimestamp_fn=function(e,t){let i=__privateGet(this,t===VIDEO_TRACK_NUMBER?_lastVideoTimestamp:t===AUDIO_TRACK_NUMBER?_lastAudioTimestamp:_lastSubtitleTimestamp);if(t!==SUBTITLE_TRACK_NUMBER){let r=__privateGet(this,t===VIDEO_TRACK_NUMBER?_firstVideoTimestamp:_firstAudioTimestamp);if("strict"===__privateGet(this,_options).firstTimestampBehavior&&-1===i&&0!==e)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${e}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.\n\nIf you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.\nIf you want to allow non-zero first timestamps, set firstTimestampBehavior: 'permissive'.\n`);"offset"===__privateGet(this,_options).firstTimestampBehavior&&(e-=r)}if(e<i)throw new Error(`Timestamps must be monotonically increasing (went from ${i} to ${e}).`);if(e<0)throw new Error(`Timestamps must be non-negative (received ${e}).`);return e},_writeBlock=new WeakSet,writeBlock_fn=function(e,t){__privateGet(this,_options).streaming&&!__privateGet(this,_tracksElement)&&(__privateMethod(this,_createTracks,createTracks_fn).call(this),__privateMethod(this,_createSegment,createSegment_fn).call(this));let i=Math.floor(e.timestamp/1e3),r=t&&"key"===e.type&&i-__privateGet(this,_currentClusterTimestamp)>=1e3;__privateGet(this,_currentCluster)&&!r||__privateMethod(this,_createNewCluster,createNewCluster_fn).call(this,i);let a=i-__privateGet(this,_currentClusterTimestamp);if(a<0)return;if(a>=MAX_CHUNK_LENGTH_MS)throw new Error(`Current Matroska cluster exceeded its maximum allowed length of ${MAX_CHUNK_LENGTH_MS} milliseconds. In order to produce a correct WebM file, you must pass in a key frame at least every ${MAX_CHUNK_LENGTH_MS} milliseconds.`);let _=new Uint8Array(4),s=new DataView(_.buffer);if(s.setUint8(0,128|e.trackNumber),s.setInt16(1,a,!1),void 0!==e.duration||e.additions){let t=Math.floor(e.duration/1e3),i={id:160,data:[{id:161,data:[_,e.data]},void 0!==e.duration?{id:155,data:t}:null,e.additions?{id:30113,data:e.additions}:null]};__privateGet(this,_writer).writeEBML(i)}else{s.setUint8(3,Number("key"===e.type)<<7);let t={id:163,data:[_,e.data]};__privateGet(this,_writer).writeEBML(t)}__privateSet(this,_duration,Math.max(__privateGet(this,_duration),i))},_createCodecPrivateElement=new WeakSet,createCodecPrivateElement_fn=function(e){return{id:25506,size:4,data:new Uint8Array(e)}},_writeCodecPrivate=new WeakSet,writeCodecPrivate_fn=function(e,t){let i=__privateGet(this,_writer).pos;__privateGet(this,_writer).seek(__privateGet(this,_writer).offsets.get(e));let r=6+t.byteLength,a=CODEC_PRIVATE_MAX_SIZE-r;if(a<0){let e=t.byteLength+a;t=t instanceof ArrayBuffer?t.slice(0,e):t.buffer.slice(0,e),a=0}e=[__privateMethod(this,_createCodecPrivateElement,createCodecPrivateElement_fn).call(this,t),{id:236,size:4,data:new Uint8Array(a)}],__privateGet(this,_writer).writeEBML(e),__privateGet(this,_writer).seek(i)},_createNewCluster=new WeakSet,createNewCluster_fn=function(e){__privateGet(this,_currentCluster)&&!__privateGet(this,_options).streaming&&__privateMethod(this,_finalizeCurrentCluster,finalizeCurrentCluster_fn).call(this),__privateGet(this,_writer)instanceof BaseStreamTargetWriter&&__privateGet(this,_writer).target.options.onCluster&&__privateGet(this,_writer).startTrackingWrites(),__privateSet(this,_currentCluster,{id:524531317,size:__privateGet(this,_options).streaming?-1:CLUSTER_SIZE_BYTES,data:[{id:231,data:e}]}),__privateGet(this,_writer).writeEBML(__privateGet(this,_currentCluster)),__privateSet(this,_currentClusterTimestamp,e);let t=__privateGet(this,_writer).offsets.get(__privateGet(this,_currentCluster))-__privateGet(this,_segmentDataOffset,segmentDataOffset_get);__privateGet(this,_cues).data.push({id:187,data:[{id:179,data:e},__privateGet(this,_options).video?{id:183,data:[{id:247,data:VIDEO_TRACK_NUMBER},{id:241,data:t}]}:null,__privateGet(this,_options).audio?{id:183,data:[{id:247,data:AUDIO_TRACK_NUMBER},{id:241,data:t}]}:null]})},_finalizeCurrentCluster=new WeakSet,finalizeCurrentCluster_fn=function(){let e=__privateGet(this,_writer).pos-__privateGet(this,_writer).dataOffsets.get(__privateGet(this,_currentCluster)),t=__privateGet(this,_writer).pos;if(__privateGet(this,_writer).seek(__privateGet(this,_writer).offsets.get(__privateGet(this,_currentCluster))+4),__privateGet(this,_writer).writeEBMLVarInt(e,CLUSTER_SIZE_BYTES),__privateGet(this,_writer).seek(t),__privateGet(this,_writer)instanceof BaseStreamTargetWriter&&__privateGet(this,_writer).target.options.onCluster){let{data:e,start:t}=__privateGet(this,_writer).getTrackedWrites();__privateGet(this,_writer).target.options.onCluster(e,t,__privateGet(this,_currentClusterTimestamp))}},_ensureNotFinalized=new WeakSet,ensureNotFinalized_fn=function(){if(__privateGet(this,_finalized))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};var _options2,_config,_preambleSeen,_preambleBytes,_preambleEmitted,_parseTimestamp,parseTimestamp_fn,_formatTimestamp,formatTimestamp_fn,cueBlockHeaderRegex=/(?:(.+?)\n)?((?:\d{2}:)?\d{2}:\d{2}.\d{3})\s+-->\s+((?:\d{2}:)?\d{2}:\d{2}.\d{3})/g,preambleStartRegex=/^WEBVTT.*?\n{2}/,timestampRegex=/(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})/,inlineTimestampRegex=/<(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})>/g,textEncoder=new TextEncoder,SubtitleEncoder=class{constructor(e){__privateAdd(this,_parseTimestamp),__privateAdd(this,_formatTimestamp),__privateAdd(this,_options2,void 0),__privateAdd(this,_config,void 0),__privateAdd(this,_preambleSeen,!1),__privateAdd(this,_preambleBytes,void 0),__privateAdd(this,_preambleEmitted,!1),__privateSet(this,_options2,e)}configure(e){if("webvtt"!==e.codec)throw new Error("Codec must be 'webvtt'.");__privateSet(this,_config,e)}encode(e){var t;if(!__privateGet(this,_config))throw new Error("Encoder not configured.");let i;if(e=e.replace("\r\n","\n").replace("\r","\n"),cueBlockHeaderRegex.lastIndex=0,!__privateGet(this,_preambleSeen)){if(!preambleStartRegex.test(e)){let e=new Error("WebVTT preamble incorrect.");throw __privateGet(this,_options2).error(e),e}i=cueBlockHeaderRegex.exec(e);let r=e.slice(0,null!=(t=null==i?void 0:i.index)?t:e.length).trimEnd();if(!r){let e=new Error("No WebVTT preamble provided.");throw __privateGet(this,_options2).error(e),e}__privateSet(this,_preambleBytes,textEncoder.encode(r)),__privateSet(this,_preambleSeen,!0),i&&(e=e.slice(i.index),cueBlockHeaderRegex.lastIndex=0)}for(;i=cueBlockHeaderRegex.exec(e);){let t=e.slice(0,i.index),r=i[1]||"",a=i.index+i[0].length,_=e.indexOf("\n",a)+1,s=e.slice(a,_).trim(),n=e.indexOf("\n\n",a);-1===n&&(n=e.length);let o=__privateMethod(this,_parseTimestamp,parseTimestamp_fn).call(this,i[2]),d=__privateMethod(this,_parseTimestamp,parseTimestamp_fn).call(this,i[3])-o,h=e.slice(_,n),p=`${s}\n${r}\n${t}`;inlineTimestampRegex.lastIndex=0,h=h.replace(inlineTimestampRegex,(e=>{let t=__privateMethod(this,_parseTimestamp,parseTimestamp_fn).call(this,e.slice(1,-1))-o;return`<${__privateMethod(this,_formatTimestamp,formatTimestamp_fn).call(this,t)}>`})),e=e.slice(n).trimStart(),cueBlockHeaderRegex.lastIndex=0;let l={body:textEncoder.encode(h),additions:""===p.trim()?void 0:textEncoder.encode(p),timestamp:1e3*o,duration:1e3*d},u={};__privateGet(this,_preambleEmitted)||(u.decoderConfig={description:__privateGet(this,_preambleBytes)},__privateSet(this,_preambleEmitted,!0)),__privateGet(this,_options2).output(l,u)}}};_options2=new WeakMap,_config=new WeakMap,_preambleSeen=new WeakMap,_preambleBytes=new WeakMap,_preambleEmitted=new WeakMap,_parseTimestamp=new WeakSet,parseTimestamp_fn=function(e){let t=timestampRegex.exec(e);if(!t)throw new Error("Expected match.");return 36e5*Number(t[1]||"0")+6e4*Number(t[2])+1e3*Number(t[3])+Number(t[4])},_formatTimestamp=new WeakSet,formatTimestamp_fn=function(e){let t=Math.floor(e/36e5),i=Math.floor(e%36e5/6e4),r=Math.floor(e%6e4/1e3),a=e%1e3;return t.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+"."+a.toString().padStart(3,"0")};export{ArrayBufferTarget,FileSystemWritableFileStreamTarget,Muxer,StreamTarget,SubtitleEncoder};
//# sourceMappingURL=/sm/0d3e520844b42a841ded286c3851a48e6b99e8c93fa0824b5d7c2fb83dda5817.map